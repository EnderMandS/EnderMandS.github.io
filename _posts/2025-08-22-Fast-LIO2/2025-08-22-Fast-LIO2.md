---
layout: post
title: "Fast-LIO2"
date: 2025-08-22 9:51:00 +0800
categories: [Paper, Lidar, SLAM]
---

# FAST-LIO2: Fast Direct LiDAR-inertial Odometry

Paper: [https://arxiv.org/abs/2107.06829](https://arxiv.org/abs/2107.06829)

特点：
1. 直接点云配准：不再提取边缘/平面等特征点，而是直接将原始点云与地图匹配
2. 增量式 k-d 树（ikd-Tree）支持动态插入、删除、重平衡，并可在树上直接下采样
3. 紧耦合迭代卡尔曼滤波（IKF）：融合 IMU 数据进行运动畸变补偿，使用优化后的卡尔曼增益计算公式，降低计算复杂度

## 框架概览

![overview](overview.jpeg)

1. 数据采集: IMU（如 200 Hz）采样角速度与加速度。LiDAR以 10–100 Hz 扫描环境，输出按时间顺序采样的原始点云

2. 前向传播（Forward Propagation）: 每到一个 IMU 采样点，根据系统动力学模型更新状态预测（位置、速度、姿态、IMU 偏置、LiDAR-IMU外参等）

3. 点云积累: 将一个扫描周期内的 LiDAR 点累积成一帧“扫描”数据（scan）

4. 后向传播（Backward Propagation）: 基于 IMU 数据推算每个 LiDAR 点在扫描周期内的相对位姿，消除运动畸变，使整帧点云等效为在扫描结束时刻采集

5. 测量更新（Iterated Update）: 以地图中的邻近点拟合局部平面，建立测量残差方程。使用迭代卡尔曼滤波（IKF）在流形空间上优化状态，直到收敛。

6. 地图更新（Mapping）: 将配准后的新点云插入 ikd-Tree，同时在树上执行空间下采样，保证地图规模受控。当 LiDAR 探测范围接近当前地图边界时，执行 box-wise 删除 移除远端旧点，实现滑动地图管理。

## iEFK模型

### 运动与测量模型

设世界系为G，IMU系为I，雷达系为L

状态量： $x = [R_{GI}, p_{GI}, v_{GI}, b_g, b_a, g^G, R_{LI}, p_{LI}]$ 包括 IMU 在世界系的姿态/位置/速度、陀螺与加速度计偏置、重力、LiDAR-IMU 外参等。

### 点的时域去畸变

原始点 $p_i^L\left(t_i\right)$ 采样在扫描周期内不同时间 $t_i$。用IMU积分得到 $ T_{GI} \left(t_i\right) $ 并“后向传播”到帧末时刻，将每个点等效到同一时间面。

### 平面拟合与法向

在ikd_Tree里用半径或最近邻搜索（通常 k=5~20）快速找到周围的地图点，即领域

对邻域 $N_i$ 计算质心 $\bar{p}_i$ 和协方差

$$ C_i = \sum_{p\in N_i} \left ( p-\bar{p}_i  \right )  \left ( p-\bar{p}_i  \right )^\mathrm{T} $$

最小特征值对应的特征向量即法向 $n_i$, 平面过点 $ \bar{p}_i $

### 点到平面残差

将点变换到世界系:

$$ p_i^G = R_{GI}\left ( R_{LI}p_i^I + p_{LI} \right ) + p_{GP} $$

残差定义为:

$$ r_i = n_i^\mathrm{T} \left ( p_i^G  - \bar{p}_i\right )  $$

采用稳健核与基于可平面性/距离的权重得到加权残差 $ \tilde{r}_i = \sqrt{w_i}r_i  $

## ikd-Tree

功能：
- 支持点插入、区域删除（box-wise）、动态重平衡。
- 原地下采样，避免额外内存/耗时。

优势：
- O(log n) 级别的插入与查询时间复杂度。
- 边插入边维护地图均匀性，减少后期重建负担。
- 通过并行重平衡机制（双线程 rebuild）降低实时性损失。

## 直接点云配准

