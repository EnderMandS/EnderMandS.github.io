---
layout: post
title: "Fast-LIO"
date: 2025-08-15 15:04:00 +0800
categories: [Paper, SLAM, Lidar]
---

# Fast-LIO

2021

Paper: [FAST-LIO: A Fast, Robust LiDAR-inertial Odometry Package by Tightly-Coupled Iterated Kalman Filter](https://arxiv.org/abs/2010.08196)

Code: [https://github.com/hku-mars/FAST_LIO](https://github.com/hku-mars/FAST_LIO)

FAST‑LIO 以紧耦合 iEKF 为核心，将高频 IMU 前后向传播与点到地图几何约束在滤波框中统一，关键在于以状态维度为主的更新复杂度，使得一次性融合大量点云观测仍具实时性。系统由两条主线程协同：IMU 高频预测与 LiDAR 批量更新，并配套地图管理与数据关联

## 背景

小 FoV、稀疏特征 → 传统 LOAM 类方法易退化。 UAV 载荷受限 → 算法必须极轻量，不能靠强算力“硬抗”.

FAST‑LIO 直接在滤波器里融合原始 LiDAR 特征点 + IMU 数据（紧耦合），保留姿态/速度与观测的相关性，退化场景下仍有鲁棒性

核心贡献:
- 正反向传播：IMU 前向积分 + 反向积分做逐点去畸变（deskew）。
- 迭代扩展卡尔曼滤波 (iEKF)：每一批特征点直接进入滤波更新。
- 卡尔曼增益新公式：计算复杂度依赖状态维而非观测维，能一次融合上千特征点而不卡顿

## 框架

把 FAST‑LIO 当作一条紧凑的流水线：IMU 高频“拉着状态往前走”，LiDAR 把每个点“时间校正后”投向地图，形成大量几何约束，全部在同一个 iEKF（迭代扩展卡尔曼滤波）里统一融合。得益于增益公式与流形更新，算法可以一次性吃下成百上千个点，输出高频稳定的姿态与轨迹

用 IMU 的短时可靠性兜住快速运动，用 LiDAR 的空间几何把长时漂移“拴回去”，并尽量让每个 LiDAR 点的几何信息都进入估计器

流程概览:
1. 预处理: 积累一段时间窗口的点形成一帧扫描，提取边缘/平面特征
2. 前向传播: 用 IMU 连续推进状态与协方差
3. 后向传播与补偿: 对每个点从采样时刻回退到扫描末时刻，做运动畸变补偿
4. 构建残差: 将点投到已建小地图，算点到平面/边的距离作为观测残差
5. iEKF 迭代更新: 线性化残差，计算更新增量，迭代到收敛
6. 更新地图: 用最新位姿把特征点写入地图，供下一帧最近邻/平面拟合使用

实现要点: 使用 KD-tree 在亚局部地图里找平面/边；通过新卡尔曼增益公式避免在巨大测量维度上求逆，大幅降时延

### 状态定义

状态向量（18 维）

$$ \mathbf{x} = \left\{ \mathbf{R}_{GI} \in SO(3),\ \mathbf{p}_{GI} \in \mathbb{R}^3,\ \mathbf{v}_I \in \mathbb{R}^3,\ \mathbf{b}^g,\ \mathbf{b}^a,\ \mathbf{g} \right\}
 $$

其中:
- $ \mathbf{R}_{GI} $ 表示IMU在世界坐标系下的旋转
- $ \mathbf{p}_{GI} $ 表示IMU 在世界坐标系的位置
- $ \mathbf{v}_I $ 表示IMU 的速度
- $ \mathbf{b}^a, \mathbf{g} $ 表示陀螺仪和加速度计偏置
- $ g $ 表示重力向量

流性运算:
姿态在 $ SO \left( 3 \right)$ 上，用“⊕/⊖”在切空间内封装最小误差，用 exp/log互转，避免冗余参数化与奇异性

封装运算(旋转和向量):
$$ R \oplus r = R\,\mathrm{Exp}(r),\quad R_1 \ominus R_2 = \mathrm{Log}(R_2^\top R_1),\quad a \oplus b = a + b $$

指数映射 $ SO \left( 3 \right)$ :

$$ \mathrm{Exp}(r) = I + \frac{\sin\|r\|}{\|r\|}\,[r]_\times + \frac{1-\cos\|r\|}{\|r\|^2}\,[r]_\times^2 $$

其中 $r$ 表示姿态最小增量（李代数）, $ \left [ r \right ] _\times  $表示叉乘矩阵

### 前向传播
每到一条 IMU 数据就推进一次状态；协方差用线性化雅可比与噪声协方差传播

#### 连续时间模型

$$ \dot{p}^G_I = v^G_I,\quad  $$

$$ \dot{v}^G_I = R^G_I\,(a^m - b_a - n_a) + g^G,\quad $$

$$ \dot{R}^G_I = R^G_I\,[\omega^m - b_\omega - n_\omega]_\times $$

$$ \dot{b}_\omega = n_{b_\omega},\quad \dot{b}_a = n_{b_a},\quad \dot{g}^G = 0 $$

其中:
- $ {p}^G_I, {v}^G_I, {R}^G_I $ : IMU 在全局系下的位置/速度/姿态
- $ a^m, \omega^m $ : IMU 加速度计/陀螺测量
- $ b_a, b_\omega $ : 零偏，建模为随机游走
- $ n_* $ : 白噪声
- $ {g}^G $ : 重力向量，作为状态估计

#### 离散时间模型

$$ x_{i+1} = x_i \oplus \big(\Delta t\; f(x_i,u_i,w_i)\big)
\qquad $$

其中: 
- $ x $: 表示联合状态（姿态、位置、速度、零偏、重力）
- $ u_i $: 表示IMU 输入 ($ a^m, \omega^m $)
- $ w_i $: 表示过程噪声

#### 前向传播
$$ P_{i+1} = F_x\,P_i\,F_x^\top + F_w\,Q\,F_w^\top $$

其中: 
- $ F_x, F_w $: 误差状态雅可比
- $ Q $: 过程噪声协方差

### 后向传播
LiDAR 每个点时间戳不同，扫描期间机体在动。用“从扫描末时刻出发的反向积分”求每个点相对扫描末的位姿，再把点补偿到统一时刻，这一步显著提升点-图匹配质量

#### 畸变补偿

$$ {}^{L_k}\!p^{f}_j = T_{LI}^{-1}\;{}^{I_k}\!T_{I_j}\;T_{LI}\;{}^{L_j}\!p^{f}_{j} $$

其中:
- $ {}^{I_k}\!T_{I_j} $: 点采样时刻j相对扫描末k的体坐标变换, 由反向积分得到
- $ T_{LI} $: LiDAR-IMU 外参
- $ {}^{L_j}\!p^{f}_{j} $: LiDAR 局部点坐标（原始测量）
- $ {}^{L_k}\!p^{f}_j $: 补偿到扫描末的点

补偿后投影到全局位置:

$$ p^G_j = T^G_{I_k}\;T_{LI}\;{}^{L_k}\!p^{f}_j $$

其中 $ T^G_{I_k} $ 为扫描末 IMU 到全局的位姿

#### 残差
$$ z_j = \mathbf{G}_j\,(p^G_j - q^G_j) $$

其中:
- $ \mathbf{G}_j $: 几何算子：平面用法向 $ u_j^T $，边可用方向/投影定义
- $ q^G_j $: 几何体上的参考点（来自局部地图拟合）
- $ z_j $: 残差（点到平面或边的距离/向量）


#### 线性化 & MAP代价

$$ 0 \approx z_j + H_j\,\delta x_k + v_j $$

$$ \min_{\delta x_k}\ \ \|\delta x_k\|_{P_k^{-1}}^2 + \sum_{j=1}^m \|z_j + H_j\,\delta x_k\|_{R_j^{-1}}^2 $$

其中:
- $ \delta x_k $: 当前迭代的状态增量（切空间）
- $ H_j $: 观测雅可比
- $ P_k $: 先验协方差
- $ R_j $: 测量噪声协方差
- $ v_j $: 测量噪声
 

#### 卡尔曼增益

$$ \text{标准:} \quad K = P H^\top (H P H^\top + R)^{-1} $$
$$ \text{新:} \quad K = \big(H^\top R^{-1} H + P^{-1}\big)^{-1}\,H^\top R^{-1} $$
$$ \delta x = Kz $$
$$ x \leftarrow x \oplus \delta x $$
$$ P \leftarrow (I - K H)\,P $$

其中:
- $ H $: 所有测量拼接的雅可比
- $ R $: 测量噪声块对角矩阵（各点独立）
- $ P $: 先验协方差
- $ z $: 拼接残差

##### 新卡尔曼提速

在 LiDAR-IMU 紧耦合的 iEKF 中，一帧 LiDAR 特征点数 m 往往达到 1000~2000 级，而状态维度 n（姿态+位置+速度+偏置+重力）通常只有 ~18

标准卡尔曼增益的计算公式:

$$ K = P H^\top (H P H^\top + R)^{-1} $$

其中:
- $ P \in \mathbb{R}^{n \times n} $: 先验状态协方差（小矩阵）
- $ H \in \mathbb{R}^{m \times n} $: 测量雅可比（行数 = 特征点数 m）
- $ R \in \mathbb{R}^{m \times m} $: 测量噪声协方差（块对角）

关键是这个 $ (H P H^\top + R)^{-1} $ 是一个 $ m \times m $, 矩阵逆运算，复杂度$ O(m^3) $


